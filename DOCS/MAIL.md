# MAIL Documentation

This document explains the functionality provided by the `mail.ts` file located in `/src/lib/mail.ts`. This module uses the Resend API to send different types of emails, including verification emails, two-factor authentication OTP emails, and password reset emails.

---

## Overview

The module initializes the Resend API with an API key from the environment and uses a base domain (also from the environment) to create links in the emails. It then defines three key functions to send various email types using pre-built React templates.

---

## Resend API Initialization

- **Initialization:**  
  The Resend API is initialized with the API key from the environment variable `RESEND_API_KEY`.

- **Domain:**  
  The base URL of the application is read from `NEXT_PUBLIC_APP_URL`.

```typescript
const resend = new Resend(process.env.RESEND_API_KEY!);
const domain = process.env.NEXT_PUBLIC_APP_URL;
```

---

## Functions

### 1. sendVerificationEmail

**Purpose:**  
Sends a verification email to a new user to confirm their email address.

**How It Works:**

- **Link Creation:**  
  A confirmation link is created by appending a token as a query parameter to the base domain.
  
- **Email Sending:**  
  The email is sent using the Resend API with:
  - A sender address (e.g., "Xvariate <verify@email.xvariate.com>").
  - A subject line: "Confirm your email".
  - The content generated by the `VerificationEmailTemplate` React component, which receives the recipient's first name and the confirmation link.

```typescript
export async function sendVerificationEmail(email: string, token: string, firstName: string) {
    const confirmLink = `${domain}/new-verification?token=${token}`;
    
    await resend.emails.send({
        from: "Xvariate <verify@email.xvariate.com>",
        to: email,
        subject: "Confirm your email",
        react: VerificationEmailTemplate({ firstName, token: confirmLink }),
    });
}
```

---

### 2. sendTwoFactorOTPEmail

**Purpose:**  
Sends an email containing a one-time password (OTP) for two-factor authentication.

**How It Works:**

- **Email Sending:**  
  Uses the Resend API to send an email with:
  - A sender address (the same as the verification email).
  - A subject line: "Two-Factor Authentication".
  - The content generated by the `TwoFactorEmailTemplate` React component, which is provided with the OTP.

```typescript
export async function sendTwoFactorOTPEmail(email: string, otp: string) {
    await resend.emails.send({
        from: "Xvariate <verify@email.xvariate.com>",
        to: email,
        subject: "Two-Factor Authentication",
        react: TwoFactorEmailTemplate({ otp }),
    });
}
```

---

### 3. sendPasswordResetEmail

**Purpose:**  
Sends a password reset email that includes a link for the user to reset their password.

**How It Works:**

- **Link Creation:**  
  A password reset link is created by appending a token as a query parameter to the base domain.
  
- **Email Sending:**  
  The email is sent using the Resend API with:
  - A sender address (e.g., "Xvariate <noreply@email.xvariate.com>").
  - A subject line: "Reset your password".
  - The content generated by the `PasswordResetEmailTemplate` React component, which receives the recipient's first name and the reset link.

```typescript
export async function sendPasswordResetEmail(email: string, token: string, firstName: string) {
    const resetLink = `${domain}/new-password?token=${token}`;
    
    await resend.emails.send({
        from: "Xvariate <noreply@email.xvariate.com>",
        to: email,
        subject: "Reset your password",
        react: PasswordResetEmailTemplate({ firstName, resetLink }),
    });
}
```

---

*End of MAIL Documentation*